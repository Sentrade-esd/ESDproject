
########################
###### kong       ######
########################
# netowrk policy
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-port-8000
  namespace: esd-project
spec:
  podSelector:
    matchLabels:
      app: kong
  policyTypes:
  - Ingress
  ingress:
  - from: []
    ports:
    - protocol: TCP
      port: 8000
    - protocol: TCP
      port: 8001

---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: kong-deployment
  namespace: esd-project
spec:
  replicas: 1
  selector:
    matchLabels:
      app: kong
  template:
    metadata:
      labels:
        app: kong
    spec:
      containers:
      - name: kong
        image: docker.io/chernise/esdproject-kong:latest
        ports:
        - containerPort: 8000
        - containerPort: 8001
---
apiVersion: v1
kind: Service
metadata:
  name: kong
spec:
  type: LoadBalancer
  selector:
    app: kong
  ports:
  - protocol: TCP
    port: 8000
    targetPort: 8000
  - protocol: TCP
    port: 8001
    targetPort: 8001
---
########################
###### prometheus ######
########################

# netowrk policy
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-port-9090
  namespace: esd-project
spec:
  podSelector:
    matchLabels:
      app: prometheus
  policyTypes:
  - Ingress
  ingress:
  - from: []
    ports:
    - protocol: TCP
      port: 9090
---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: prometheus-deployment
  namespace: esd-project
spec:
  replicas: 1
  selector:
    matchLabels:
      app: prometheus
  template:
    metadata:
      labels:
        app: prometheus
    spec:
      containers:
      - name: prometheus
        image: docker.io/chernise/esdproject-prometheus:latest
        ports:
        - containerPort: 9090
---
apiVersion: v1
kind: Service
metadata:
  name: prometheus
  namespace: esd-project
spec:
  type: LoadBalancer
  selector:
    app: prometheus
  ports:
  - protocol: TCP
    port: 9090
    targetPort: 9090
---
########################
###### grafana    ######
########################

# netowrk policy
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-port-3000
  namespace: esd-project
spec:
  podSelector:
    matchLabels:
      app: grafana
  policyTypes:
  - Ingress
  ingress:
  - from: []
    ports:
    - protocol: TCP
      port: 3000
---

apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana-deployment
  namespace: esd-project
spec:
  replicas: 1
  selector:
    matchLabels:
      app: grafana
  template:
    metadata:
      labels:
        app: grafana
    spec:
      containers:
      - name: grafana
        image: docker.io/chernise/esdproject-grafana:latest
        ports:
        - containerPort: 3000

---
apiVersion: v1
kind: Service
metadata:
  name: grafana
  namespace: esd-project
spec:
  type: LoadBalancer
  selector:
    app: grafana
  ports:
  - protocol: TCP
    port: 8100
    targetPort: 3000
